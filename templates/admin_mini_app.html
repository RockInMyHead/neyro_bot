<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å - –ù–µ–π—Ä–æ-–±–æ—Ç</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='admin_app/admin_mini_app.css') }}?v=4">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üîß</text></svg>">
</head>
<body>
    <div class="container">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <header class="header">
            <div class="header-content">
                <div class="header-info">
            <h1>üîß –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</h1>
            <p>–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</p>
                </div>
                <button class="logout-btn" onclick="logoutAdmin()" title="–í—ã–π—Ç–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M7 3H5a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h2M13 7l3 3-3 3M16 10H7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>–í—ã–π—Ç–∏</span>
                </button>
            </div>
        </header>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <main class="main-content">

            <!-- NEW: –£–º–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –±–∞—Ç—á–µ–π -->
            <div class="card">
                <h2>üöÄ –£–º–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –±–∞—Ç—á–µ–π</h2>
                <div class="smart-batch-container">
                    <div class="current-mixed-text">
                        <h3>üìù –¢–µ–∫—É—â–∏–π –º–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç</h3>
                        <div class="mixed-text" id="current-mixed-text">
                            –û–∂–∏–¥–∞–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏...
                        </div>
                    </div>
                    
                    <div class="smart-batch-stats-container">
                        <div class="stats-dropdown-header" onclick="toggleStatsDropdown()">
                            <span id="stats-summary">–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...</span>
                            <span class="dropdown-arrow">‚ñº</span>
                        </div>
                        <div class="stats-dropdown" id="stats-dropdown">
                            <div class="smart-batch-stats" id="smart-batch-stats">
                                –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...
                            </div>
                        </div>
                    </div>
                    
                    <div class="batch-controls">
                        <button id="create-batches-btn" class="btn btn-primary" onclick="forceCreateBatches()">üîÑ –°–æ–∑–¥–∞—Ç—å –±–∞—Ç—á–∏</button>
                        <button id="process-next-btn" class="btn btn-success" onclick="processNextBatch()">‚ñ∂Ô∏è –û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–π</button>
                        <button id="clear-messages-btn" class="btn btn-warning" onclick="clearAllMessages()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è</button>
                        <button id="clear-all-chats-btn" class="btn btn-danger" onclick="clearAllChats()">üí• –û—á–∏—Å—Ç–∏—Ç—å –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é —á–∞—Ç–æ–≤</button>
                    </div>
                    
               <div class="smart-batch-list-container">
                   <h3>üìä –°–ø–∏—Å–æ–∫ –±–∞—Ç—á–µ–π</h3>
                   <div class="smart-batch-list" id="smart-batch-list">
                       –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –±–∞—Ç—á–µ–π...
                   </div>
               </div>
               
               <div class="generated-images-container">
                   <h3>üñºÔ∏è –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</h3>
                   <div class="images-grid" id="images-grid">
                       –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π...
                   </div>
                    </div>
                </div>
            </div>

            <!-- –í—ã–±–æ—Ä –±–∞–∑–æ–≤–æ–≥–æ –ø—Ä–æ–º—Ç–∞ -->
            <div class="card">
                <h2>üé¨ –ë–∞–∑–æ–≤—ã–µ –ø—Ä–æ–º—Ç—ã —Ñ–∏–ª—å–º–æ–≤</h2>
                <div class="prompt-manager">
                    <div class="prompt-dropdown-container">
                        <div class="prompt-dropdown-header" onclick="togglePromptDropdown()">
                            <span id="current-prompt-dropdown-title">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–º—Ç...</span>
                            <span class="dropdown-arrow">‚ñº</span>
                        </div>
                        <div class="prompt-dropdown" id="prompt-dropdown">
                            <div class="prompt-list" id="prompt-list">
                                <!-- –ü—Ä–æ–º—Ç—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                            </div>
                    </div>
                    </div>
                    
                    <div class="prompt-preview" id="prompt-preview">
                        <h4>–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä:</h4>
                        <div class="prompt-preview-content">
                        <div class="prompt-text" id="prompt-text">
                                –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–º—Ç –∏–∑ —Å–ø–∏—Å–∫–∞ –≤—ã—à–µ
                            </div>
                            <div class="prompt-edit-controls">
                                <button class="btn-small edit-btn" onclick="togglePromptEdit()" id="edit-prompt-btn">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                                <button class="btn-small save-btn" onclick="savePromptEdit()" id="save-prompt-btn" style="display: none;">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                                <button class="btn-small cancel-btn" onclick="cancelPromptEdit()" id="cancel-prompt-btn" style="display: none;">‚ùå –û—Ç–º–µ–Ω–∞</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="prompt-controls">
                        <button class="btn btn-primary" onclick="updateBasePrompt()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–º—Ç</button>
                        <button class="btn btn-success" onclick="nextPrompt()">‚û°Ô∏è –î–∞–ª–µ–µ</button>
                        <button class="btn btn-secondary" onclick="addNewPrompt()">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>
                    </div>
                </div>
            </div>

            <!-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è -->
            <div class="card">
                <h2>üí¨ –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è</h2>
                <div class="messages-container" id="messages-container">
                    <div class="no-messages">–ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π</div>
                </div>
                <button class="btn btn-secondary" onclick="refreshMessages()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
            </div>


            <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ü–µ—Ä—Ç–æ–º -->
            <div class="card">
                <h2>üéº –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ü–µ—Ä—Ç–æ–º</h2>
                <div class="concert-controls">
                    <div class="concert-section">
                        <h3>üìΩÔ∏è –°–æ–æ–±—â–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ —Ç—Ä–µ–∫–æ–º</h3>
                        <div class="generated-content">
                            <div class="content-item">
                                <label>–ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏–ª—å–º–∞:</label>
                                <div class="content-display" id="current-prompt-title">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–º—Ç</div>
                                <textarea class="content-edit" id="current-prompt-title-edit" style="display: none;"></textarea>
                                <div class="content-actions">
                                    <button class="btn-small edit-btn" onclick="toggleEdit('current-prompt-title')">‚úèÔ∏è</button>
                                </div>
                            </div>
                            <div class="content-item">
                                <label>–ö–æ—Ä–æ—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ:</label>
                                <div class="content-display" id="generated-movie-description">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                                <textarea class="content-edit" id="generated-movie-description-edit" style="display: none;"></textarea>
                                <div class="content-actions">
                                <button class="btn-small edit-btn" onclick="toggleEdit('generated-movie-description')">‚úèÔ∏è</button>
                                    <button class="btn-small regenerate-btn" onclick="regenerateFilmDescription()" title="–†–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ">üîÑ</button>
                                </div>
                            </div>
                            <div class="content-item">
                                <label>–ê–∫—Ç—ë—Ä—ã/–ø–µ—Ä—Å–æ–Ω–∞–∂–∏:</label>
                                <div class="content-display" id="generated-movie-actors">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                                <textarea class="content-edit" id="generated-movie-actors-edit" style="display: none;"></textarea>
                                <button class="btn-small edit-btn" onclick="toggleEdit('generated-movie-actors')">‚úèÔ∏è</button>
                            </div>
                        </div>
                        <div class="edit-controls" style="margin-top: 10px;">
                            <button class="btn-small btn-success" onclick="saveAllEdits()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ</button>
                            <button class="btn-small btn-secondary" onclick="cancelAllEdits()">‚ùå –û—Ç–º–µ–Ω–∏—Ç—å –≤—Å–µ</button>
                        </div>
                        <button class="btn btn-primary" onclick="sendTrackMessage()">üéµ –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ —Ç—Ä–µ–∫–æ–º</button>
                    </div>
                    
                    <div class="concert-section">
                        <h3 style="color: #000000;">üéâ –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∫–æ–Ω—Ü–µ—Ä—Ç–∞</h3>
                        <div class="content-item">
                            <label>–§–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:</label>
                            <div class="content-display" id="concert-end-message">–°–ø–∞—Å–∏–±–æ, —á—Ç–æ –±—ã–ª–∏ —Å –Ω–∞–º–∏ ‚Äî Main Strings Orchestra √ó Neuroevent.
–û—Å—Ç–∞–≤—å—Ç–µ –∫–æ—Ä–æ—Ç–∫–∏–π –æ—Ç–∑—ã–≤ ‚Äî —ç—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç –Ω–∞–º —Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è –ª—É—á—à–µ!
P.S. –û—Ç–≤–µ—Ç—ã –∞–Ω–æ–Ω–∏–º–Ω—ã.</div>
                            <textarea class="content-edit" id="concert-end-message-edit" style="display: none;">–°–ø–∞—Å–∏–±–æ, —á—Ç–æ –±—ã–ª–∏ —Å –Ω–∞–º–∏ ‚Äî Main Strings Orchestra √ó Neuroevent.
–û—Å—Ç–∞–≤—å—Ç–µ –∫–æ—Ä–æ—Ç–∫–∏–π –æ—Ç–∑—ã–≤ ‚Äî —ç—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç –Ω–∞–º —Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è –ª—É—á—à–µ!
P.S. –û—Ç–≤–µ—Ç—ã –∞–Ω–æ–Ω–∏–º–Ω—ã.</textarea>
                            <button class="btn-small edit-btn" onclick="toggleEdit('concert-end-message')">‚úèÔ∏è</button>
                        </div>
                        <button class="btn btn-success" onclick="sendConcertEnd()">üèÅ –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ</button>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>üé® –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</h2>
                <div class="image-generation-section">
                    <div class="content-item">
                        <label for="custom-prompt">–í–∞—à –ø—Ä–æ–º—Ç –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:</label>
                        <textarea 
                            id="custom-prompt" 
                            placeholder="–û–ø–∏—à–∏—Ç–µ, –∫–∞–∫–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—ã —Ö–æ—Ç–∏—Ç–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å..."
                            rows="3"
                            style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-family: inherit; resize: vertical;"
                        ></textarea>
                    </div>
                    <div class="content-item">
                        <label>–ë–∞–∑–æ–≤—ã–π –ø—Ä–æ–º—Ç:</label>
                        <div id="current-base-prompt" style="padding: 10px; background: #f5f5f5; border-radius: 5px; font-style: italic; color: #666;">
                            –ó–∞–≥—Ä—É–∑–∫–∞ –±–∞–∑–æ–≤–æ–≥–æ –ø—Ä–æ–º—Ç–∞...
                        </div>
                    </div>
                    <div class="content-item">
                        <label>–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –ø–æ–ª–Ω–æ–≥–æ –ø—Ä–æ–º—Ç–∞:</label>
                        <div id="full-prompt-preview" style="padding: 10px; background: #e8f4fd; border-radius: 5px; font-family: monospace; font-size: 14px; max-height: 150px; overflow-y: auto;">
                            –í–≤–µ–¥–∏—Ç–µ –≤–∞—à –ø—Ä–æ–º—Ç –¥–ª—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞...
                        </div>
                    </div>
                    <div class="control-buttons" style="margin-top: 15px;">
                        <button class="btn btn-primary" onclick="generateCustomImage()" id="generate-image-btn">
                            üé® –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                        </button>
                        <button class="btn btn-secondary" onclick="previewFullPrompt()" id="preview-btn">
                            üëÅÔ∏è –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä
                        </button>
                    </div>
                    <div id="image-generation-status" style="margin-top: 15px; display: none;">
                        <div class="loading-spinner"></div>
                        <span>–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è...</span>
                    </div>
                    <div id="generated-image-container" style="margin-top: 15px; display: none;">
                        <h4>–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ:</h4>
                        <div style="text-align: center;">
                            <img id="generated-image" style="max-width: 100%; max-height: 400px; width: auto; height: auto; object-fit: contain; border-radius: 5px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        </div>
                        <div style="margin-top: 10px; text-align: center;">
                            <button class="btn btn-success" onclick="downloadGeneratedImage()" id="download-btn">
                                üíæ –°–∫–∞—á–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h2>
                <div class="control-buttons">
                    <button class="btn btn-danger" onclick="resetStats()">üîÑ –°–±—Ä–æ—Å–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É</button>
                    <button class="btn btn-warning" onclick="exportData()">üì§ –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</button>
                </div>
            </div>
        </main>

        <!-- –ü–æ–¥–≤–∞–ª -->
        <footer class="footer">
            <p>–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</p>
        </footer>
    </div>

    <script src="{{ url_for('static', filename='admin_app/admin_mini_app.js') }}?v=41"></script>
</body>
</html>
